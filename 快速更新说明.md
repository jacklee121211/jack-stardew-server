# 快速更新 entrypoint.sh 说明

## 原理

通过将 `entrypoint.sh` 作为 volume 挂载到容器中，修改脚本后只需重启容器即可生效，**无需重新构建 Docker 镜像**。

这大大加快了开发和调试速度，避免了每次都要重新构建镜像的等待时间。

## 使用方法

### 1. 修改 entrypoint.sh

编辑 `docker/scripts/entrypoint.sh` 文件：

```bash
# 在本地或服务器上
nano docker/scripts/entrypoint.sh
# 或使用你喜欢的编辑器
```

### 2. 确保脚本有执行权限

```bash
chmod +x docker/scripts/entrypoint.sh
```

### 3. 重启容器（无需重建镜像）

```bash
# 方法一：使用 docker compose
docker compose restart stardew-server

# 方法二：停止后启动（如果 restart 不生效）
docker compose stop stardew-server
docker compose start stardew-server

# 方法三：完全重启（推荐，确保新脚本生效）
docker compose down
docker compose up -d
```

### 4. 查看日志确认

```bash
docker compose logs -f stardew-server
```

## 配置说明

在 `docker-compose.yml` 中，已添加以下配置：

```yaml
volumes:
  # ... 其他挂载 ...
  # Mount entrypoint.sh for hot-reload (no rebuild needed)
  # 挂载 entrypoint.sh 以便热更新（无需重建镜像）
  - ./docker/scripts/entrypoint.sh:/home/steam/entrypoint.sh:ro
```

- `ro` = 只读模式，防止容器内意外修改
- 挂载会覆盖镜像中的 `entrypoint.sh`

## 优势

✅ **快速迭代** - 修改后立即生效，无需等待构建  
✅ **节省时间** - 跳过 Docker 镜像构建（通常需要几分钟）  
✅ **节省带宽** - 无需上传/下载整个镜像  
✅ **调试方便** - 快速测试不同的配置和修复  

## 注意事项

⚠️ **首次部署** - 如果修改了 Dockerfile 中的其他内容（如依赖安装），仍需要重新构建镜像

⚠️ **权限问题** - 确保本地 `docker/scripts/entrypoint.sh` 有执行权限：
```bash
chmod +x docker/scripts/entrypoint.sh
```

⚠️ **文件同步** - 在服务器上使用时，修改后需要 `git push` 然后 `git pull`，或直接在服务器上编辑

## 服务器端快速更新流程

```bash
# 1. 拉取最新代码
cd /jack-stardew-server
git pull origin main

# 2. 确保执行权限
chmod +x docker/scripts/entrypoint.sh

# 3. 重启容器（无需 build）
docker compose restart stardew-server

# 4. 查看日志
docker compose logs -f stardew-server
```

## 完整更新流程（对比）

### 旧方法（每次都要构建）
```bash
git pull origin main
docker compose down
docker compose build --no-cache  # ⏱️ 需要几分钟
docker compose up -d
```

### 新方法（只更新 entrypoint.sh）
```bash
git pull origin main
chmod +x docker/scripts/entrypoint.sh
docker compose restart stardew-server  # ⚡ 几秒钟
```

节省时间：**几分钟 → 几秒钟** 🚀

